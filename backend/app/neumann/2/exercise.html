<div class="black-badge">Do</div>
Let's do a simulation today. You're a trader now. You will have 50 market days where you need to try predicting the market for the next day. Click buy if you think it goes up and sell if it goes down.
<br /><br />


<style>
  .wrapper {
    font-family: system-ui, sans-serif;
    background: #0e0e0e;
    color: #eaeaea;
    text-align: center;
  }

  h1 {
    font-weight: 600;
    margin-top: 20px;
  }

  canvas {
    background: linear-gradient(#0b0b0b, #111);
    border: 1px solid #333;
    margin: 20px auto;
    display: block;
  }

  button {
    background: #222;
    color: #eee;
    border: 1px solid #444;
    padding: 10px 18px;
    margin: 5px;
    font-size: 15px;
    cursor: pointer;
  }

  button:hover {
    background: #333;
  }

  .stats {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-top: 15px;
    min-height: 200px;
  }

  .card {
    background: #161616;
    padding: 15px;
    width: 220px;
    border-radius: 6px;
    border: 1px solid #333;
  }

  .muted {
    color: #aaa;
    font-size: 13px;
  }

  button.buy-flash {
    box-shadow: 0 0 12px #4caf50;
  }

  button.sell-flash {
    box-shadow: 0 0 12px #f44336;
  }

  .flash-green {
    stroke: #6dff6d !important;
  }

  .flash-red {
    stroke: #ff6d6d !important;
  }

</style>

<div class="wrapper">
  <h1>You vs The Market</h1>
  <p class="muted">Trade if you think it helps.</p>

  <canvas id="chart-day2" width="800" height="320"></canvas>

  <div>
    <button class="buy-btn">BUY</button>
    <button class="sell-btn">SELL</button>
    <button class="hold-btn">HOLD YOUR POSITION</button>
  </div>

  <div class="stats">
    <div class="card" id="you-day2"></div>
    <div class="card" id="investor-day2"></div>
  </div>
</div>
<br>
<script>
(function() {
  console.log('Day 2 exercise script loading...');
  
  // Wait for DOM to be ready
  function initExercise() {
    console.log('Initializing Day 2 exercise...');
    
    const canvas = document.getElementById("chart-day2");
    if (!canvas) {
      console.error('Canvas element not found!');
      setTimeout(initExercise, 100);
      return;
    }
    
    const ctx = canvas.getContext("2d");
    
    let day = 0;
    let prices = [100];
    const maxDays = 50;
    
    // Market parameters
    let drift = 0.0006;
    let volatility = 0.02;
    
    // Player
    let you = {
      cash: 10000,
      shares: 0,
      trades: 0,
      fees: 0
    };
    
    // Investor (buy & hold)
    let investor = {
      shares: 10000 / prices[0]
    };
    
    const fee = 5;
    
    let markers = []; 
    
    /* ====== MARKET ====== */
    function generatePrice() {
      const shock = volatility * (Math.random() - 0.5);
      const next = prices[prices.length - 1] * (1 + drift + shock);
      prices.push(Math.max(next, 20));
    }
    
    /* ====== ACTIONS ====== */
    function buy() {
      if (you.cash > 0) {
        you.shares += (you.cash - fee) / prices[day];
        you.cash = 0;
        you.trades++;
        you.fees += fee;
    
        markers.push({ day, price: prices[day], type: "buy" });
        flash("buy");
        nextDay();
      }
    }
    
    function sell() {
      if (you.shares > 0) {
        you.cash += you.shares * prices[day] - fee;
        you.shares = 0;
        you.trades++;
        you.fees += fee;
    
        markers.push({ day, price: prices[day], type: "sell" });
        flash("sell");
        nextDay();
      }
    }
    
    
    function nextDay() {
      if (day >= maxDays) return;
      day++;
      generatePrice();
      drawChart();
      updateStats();
    
      // Quiet punishment for overtrading
      if (you.trades > 10) volatility *= 1.002;
    
      if (day === maxDays) {
        setTimeout(() => {
          alert("Simulation complete.\nLook who worked harder.\nLook who won.");
        }, 100);
      }
    }
    
    /* ====== DRAWING ====== */
    function drawChart() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    
      // Scale
      const visible = prices.slice(0, day + 1);
      const min = Math.min(...visible);
      const max = Math.max(...visible);
      const padding = 30;
    
      const xStep = (canvas.width - padding * 2) / maxDays;
      const yScale = (canvas.height - padding * 2) / (max - min);
    
      // Grid
      ctx.strokeStyle = "#222";
      ctx.lineWidth = 1;
      for (let i = 0; i < 5; i++) {
        let y = padding + i * (canvas.height - padding * 2) / 4;
        ctx.beginPath();
        ctx.moveTo(padding, y);
        ctx.lineTo(canvas.width - padding, y);
        ctx.stroke();
      }
    
      // Price line
      ctx.beginPath();
      ctx.strokeStyle = "#4caf50";
      ctx.lineWidth = 2;
    
      visible.forEach((p, i) => {
        const x = padding + i * xStep;
        const y = canvas.height - padding - (p - min) * yScale;
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      });
    
      ctx.stroke();
    
      markers.forEach(m => {
        const x = padding + m.day * xStep;
        const y = canvas.height - padding - (m.price - min) * yScale;
    
        ctx.fillStyle = m.type === "buy" ? "#4caf50" : "#f44336";
        ctx.beginPath();
    
        if (m.type === "buy") {
          // Up triangle
          ctx.moveTo(x, y - 8);
          ctx.lineTo(x - 6, y + 6);
          ctx.lineTo(x + 6, y + 6);
        } else {
          // Down triangle
          ctx.moveTo(x, y + 8);
          ctx.lineTo(x - 6, y - 6);
          ctx.lineTo(x + 6, y - 6);
        }
    
        ctx.closePath();
        ctx.fill();
      });
    }
    
    /* ====== STATS ====== */
    function updateStats() {
      const youValue = you.cash + you.shares * prices[day];
      const investorValue = investor.shares * prices[day];
    
      const youElement = document.getElementById("you-day2");
      const investorElement = document.getElementById("investor-day2");
      
      if (youElement) {
        youElement.innerHTML = `
          <h3>You</h3>
          Value: $${youValue.toFixed(0)}<br>
          Trades: ${you.trades}<br>
          Fees Paid: $${you.fees}
        `;
      }
      
      if (investorElement) {
        investorElement.innerHTML = `
          <h3>Investor</h3>
          Value: $${investorValue.toFixed(0)}<br>
          Trades: 1<br>
          <span class="muted">Did nothing</span>
        `;
      }
    }
    
    function flash(type) {
      const btn = document.querySelector(
        type === "buy" ? ".buy-btn" : ".sell-btn"
      );
    
      if (btn) {
        btn.classList.add(type === "buy" ? "buy-flash" : "sell-flash");
    
        setTimeout(() => {
          btn.classList.remove("buy-flash", "sell-flash");
        }, 200);
      }
    
      // Line flash
      ctx.strokeStyle = type === "buy" ? "#6dff6d" : "#ff6d6d";
      setTimeout(drawChart, 150);
    }
    
    /* ====== INIT ====== */
    drawChart();
    updateStats();
    
    // Attach event listeners
    const buyBtn = document.querySelector(".buy-btn");
    const sellBtn = document.querySelector(".sell-btn");
    const holdBtn = document.querySelector(".hold-btn");
    
    if (buyBtn) buyBtn.addEventListener("click", buy);
    if (sellBtn) sellBtn.addEventListener("click", sell);
    if (holdBtn) holdBtn.addEventListener("click", nextDay);
    
    console.log('Day 2 exercise initialized successfully');
  }
  
  // Start initialization
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initExercise);
  } else {
    // DOM already loaded
    setTimeout(initExercise, 100);
  }
})();


